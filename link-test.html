<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Link Diagnostic Test</title>
    <link rel="stylesheet" href="styles.css?v=50">
    <style>
        body { margin: 0; padding: 20px; font-family: monospace; background: #f0f0f0; }
        .test-container { max-width: 1200px; margin: 0 auto; }
        .test-section { background: white; padding: 20px; margin: 10px 0; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
        button { background: #007cba; color: white; border: none; padding: 10px 20px; border-radius: 4px; cursor: pointer; margin: 5px; }
        button:hover { background: #005a87; }
        .results { background: #f8f9fa; padding: 15px; border-radius: 4px; margin: 10px 0; font-family: monospace; white-space: pre-wrap; }
        .status { padding: 10px; border-radius: 4px; margin: 10px 0; }
        .success { background: #d4edda; color: #155724; border: 1px solid #c3e6cb; }
        .warning { background: #fff3cd; color: #856404; border: 1px solid #ffeaa7; }
        .error { background: #f8d7da; color: #721c24; border: 1px solid #f5c6cb; }
        .test-links { background: #e8f4fd; padding: 15px; border-radius: 4px; margin: 10px 0; }
    </style>
</head>
<body>
    <div class="test-container">
        <h1>üîç Link Diagnostic Test</h1>
        
        <div class="test-section">
            <h2>Test Controls</h2>
            <button onclick="runDiagnostic()">Run Full Diagnostic</button>
            <button onclick="testNavigation()">Test Section Navigation</button>
            <button onclick="openMainSite()">Open Main Site</button>
            <button onclick="clearResults()">Clear Results</button>
        </div>

        <div class="test-section">
            <h2>Navigation Test</h2>
            <div class="test-links">
                <p><strong>Test Steps:</strong></p>
                <ol>
                    <li>Click "Open Main Site" to open the main FieldTrip site</li>
                    <li>Click the down arrow to go to Section 2</li>
                    <li>Click the up arrow to return to Section 1</li>
                    <li>Try clicking the CTA button and down arrow in Section 1</li>
                    <li>Report if any links are unresponsive or shifted</li>
                </ol>
            </div>
        </div>

        <div class="test-section">
            <h2>Results</h2>
            <div id="results" class="results">Click "Run Full Diagnostic" to start analysis...</div>
        </div>

        <div class="test-section">
            <h2>Common Issues to Check</h2>
            <div class="results">
üîç POTENTIAL ISSUES:
===================

1. Z-INDEX CONFLICTS:
   - Section 2 may have higher z-index than Section 1
   - Contact overlay may remain visible
   - Transform creates new stacking context

2. TRANSFORM RESIDUE:
   - Section 2 transform may not reset properly
   - Section 1 transform may be affected
   - Viewport recalculation may shift positions

3. POINTER EVENTS:
   - Links may have pointer-events: none
   - Overlapping elements may block clicks
   - Opacity/visibility issues

4. POSITIONING ISSUES:
   - Absolute positioning conflicts
   - Viewport unit recalculation
   - Safe-area padding changes

5. ANIMATION RESIDUE:
   - Transition delays not cleared
   - CSS classes not properly reset
   - JavaScript state not updated
            </div>
        </div>
    </div>

    <script src="app.js?v=18"></script>
    <script src="link-diagnostic.js"></script>
    <script>
        function runDiagnostic() {
            const results = document.getElementById('results');
            
            // Capture console output
            const originalLog = console.log;
            let output = '';
            console.log = function(...args) {
                output += args.join(' ') + '\n';
                originalLog.apply(console, args);
            };
            
            // Run the diagnostic script
            try {
                eval(diagnosticScript);
                
                // Restore console.log
                console.log = originalLog;
                
                // Display results
                results.innerHTML = output;
                
            } catch (error) {
                results.innerHTML = 'Error running diagnostic: ' + error.message;
            }
        }

        function testNavigation() {
            const results = document.getElementById('results');
            results.innerHTML = 'Navigation test instructions:\n\n' +
                '1. Open main site in new tab\n' +
                '2. Navigate to Section 2 (down arrow)\n' +
                '3. Return to Section 1 (up arrow)\n' +
                '4. Test Section 1 links (CTA button, down arrow)\n' +
                '5. Check if links are responsive and properly positioned\n\n' +
                'Report any issues found.';
        }

        function openMainSite() {
            window.open('index.html', '_blank');
        }

        function clearResults() {
            document.getElementById('results').innerHTML = 'Results cleared.';
        }

        // Store the diagnostic script for re-running
        const diagnosticScript = `
console.log('üîç LINK DIAGNOSTIC TOOL');
console.log('========================');

// 1. Inspect HTML structure and link locations
console.log('\\nüìã 1. HTML STRUCTURE ANALYSIS');
console.log('-------------------------------');

const section1Links = document.querySelectorAll('section#section-1 a, section#section-1 button');
console.log('Section 1 links found:', section1Links.length);

section1Links.forEach((link, index) => {
    console.log(\`Link \${index + 1}:\`, {
        tagName: link.tagName,
        id: link.id,
        className: link.className,
        textContent: link.textContent?.trim() || 'No text',
        parentElement: link.parentElement?.className || 'No parent'
    });
});

// 2. Check CSS interaction layers
console.log('\\nüé® 2. CSS INTERACTION LAYERS');
console.log('-----------------------------');

section1Links.forEach((link, index) => {
    const computedStyle = getComputedStyle(link);
    const rect = link.getBoundingClientRect();
    
    console.log(\`Link \${index + 1} (\${link.id || link.className}):\`, {
        position: computedStyle.position,
        zIndex: computedStyle.zIndex,
        pointerEvents: computedStyle.pointerEvents,
        visibility: computedStyle.visibility,
        opacity: computedStyle.opacity,
        transform: computedStyle.transform,
        display: computedStyle.display,
        boundingRect: {
            top: Math.round(rect.top),
            left: Math.round(rect.left),
            width: Math.round(rect.width),
            height: Math.round(rect.height)
        }
    });
});

// 3. Check for overlapping elements
console.log('\\nüîç 3. OVERLAPPING ELEMENTS CHECK');
console.log('--------------------------------');

// Test click at various positions around Section 1 links
const testPoints = [
    { x: window.innerWidth / 2, y: window.innerHeight - 100, name: 'Bottom center' },
    { x: window.innerWidth / 2, y: window.innerHeight - 150, name: 'Above bottom' },
    { x: window.innerWidth / 2, y: window.innerHeight - 200, name: 'Middle bottom' }
];

testPoints.forEach(point => {
    const element = document.elementFromPoint(point.x, point.y);
    console.log(\`\${point.name} (\${point.x}, \${point.y}):\`, {
        element: element?.tagName || 'None',
        className: element?.className || 'None',
        id: element?.id || 'None',
        textContent: element?.textContent?.trim().substring(0, 20) || 'None'
    });
});

// 4. Check section states
console.log('\\nüì± 4. SECTION STATES');
console.log('--------------------');

const section1 = document.querySelector('#section-1');
const section2 = document.querySelector('#section-2');

console.log('Section 1:', {
    hasActiveClass: section1?.classList.contains('section--active'),
    opacity: getComputedStyle(section1).opacity,
    visibility: getComputedStyle(section1).visibility,
    transform: getComputedStyle(section1).transform,
    zIndex: getComputedStyle(section1).zIndex,
    position: getComputedStyle(section1).position
});

console.log('Section 2:', {
    hasActiveClass: section2?.classList.contains('section--active'),
    opacity: getComputedStyle(section2).opacity,
    visibility: getComputedStyle(section2).visibility,
    transform: getComputedStyle(section2).transform,
    zIndex: getComputedStyle(section2).zIndex,
    position: getComputedStyle(section2).position
});

// 5. Check contact overlay state
console.log('\\nüîó 5. CONTACT OVERLAY STATE');
console.log('--------------------------');

const contactOverlay = document.querySelector('.contact-overlay');
console.log('Contact Overlay:', {
    hasVisibleClass: contactOverlay?.classList.contains('contact-overlay--visible'),
    opacity: getComputedStyle(contactOverlay).opacity,
    visibility: getComputedStyle(contactOverlay).visibility,
    zIndex: getComputedStyle(contactOverlay).zIndex,
    position: getComputedStyle(contactOverlay).position
});

// 6. Test link clickability
console.log('\\nüñ±Ô∏è 6. LINK CLICKABILITY TEST');
console.log('----------------------------');

section1Links.forEach((link, index) => {
    const rect = link.getBoundingClientRect();
    const centerX = rect.left + rect.width / 2;
    const centerY = rect.top + rect.height / 2;
    
    const elementAtCenter = document.elementFromPoint(centerX, centerY);
    const isClickable = elementAtCenter === link;
    
    console.log(\`Link \${index + 1} clickability:\`, {
        isClickable: isClickable,
        elementAtCenter: elementAtCenter?.tagName || 'None',
        centerPoint: \`(\${Math.round(centerX)}, \${Math.round(centerY)})\`,
        boundingRect: {
            top: Math.round(rect.top),
            left: Math.round(rect.left),
            width: Math.round(rect.width),
            height: Math.round(rect.height)
        }
    });
});

console.log('\\n‚úÖ DIAGNOSTIC COMPLETE');
console.log('======================');
        `;
    </script>
</body>
</html>
